server:
  port: 8080

spring:
  application:
    name: transaction-service
  
  r2dbc:
    url: r2dbc:postgresql://localhost:5432/transactions_db
    username: postgres
    password: postgres
    pool:
      initial-size: 10
      max-size: 50
      max-idle-time: 30m
      max-acquire-time: 3s
  
  kafka:
    bootstrap-servers: localhost:9092
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.apache.kafka.common.serialization.StringSerializer
      acks: all
      retries: 3
      properties:
        max.in.flight.requests.per.connection: 5
        enable.idempotence: true
        request.timeout.ms: 60000
        connections.max.idle.ms: 600000
        metadata.max.age.ms: 180000
    consumer:
      group-id: transaction-service-group
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      auto-offset-reset: earliest
      enable-auto-commit: false
      properties:
        max.poll.records: 100
        session.timeout.ms: 30000

# Configuración de tópicos de Kafka
kafka:
  topics:
    transaction-creation: transaction-creation-topic
    anti-fraud-validation: anti-fraud-validation-topic
  consumer:
    concurrency: 3
    max-poll-records: 100

# Logging
logging:
  level:
    root: INFO
    com.example.transactionservice: DEBUG
    org.springframework.r2dbc: DEBUG
    reactor.kafka: DEBUG

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  metrics:
    export:
      prometheus:
        enabled: true

---
spring:
  config:
    activate:
      on-profile: docker
  
  r2dbc:
    url: ${SPRING_R2DBC_URL}
    username: ${SPRING_R2DBC_USERNAME}
    password: ${SPRING_R2DBC_PASSWORD}
  
  kafka:
    bootstrap-servers: ${SPRING_KAFKA_BOOTSTRAP_SERVERS}
